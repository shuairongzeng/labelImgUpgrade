# ğŸ”§ æ™ºèƒ½é¢„æµ‹ç»“æœè‡ªåŠ¨æ˜¾ç¤ºä¿®å¤è¯´æ˜

## ğŸ¯ é—®é¢˜æè¿°

**ç”¨æˆ·åé¦ˆçš„é—®é¢˜ï¼š**
> "åŠŸèƒ½æ˜¯å®ç°äº†ï¼Œä½†æ˜¯é¢„æµ‹åçš„ç»“æœï¼Œå¹¶æ²¡æœ‰åœ¨å›¾ç‰‡ä¸Šç»˜åˆ¶å‡ºæ¥ï¼Œä½“éªŒå¾ˆä¸å¥½"

**é—®é¢˜åˆ†æï¼š**
æ™ºèƒ½é¢„æµ‹åŠŸèƒ½è™½ç„¶èƒ½å¤ŸæˆåŠŸæ‰§è¡Œé¢„æµ‹ï¼Œä½†é¢„æµ‹ç»“æœæ²¡æœ‰è‡ªåŠ¨æ˜¾ç¤ºåœ¨ç”»å¸ƒä¸Šï¼Œç”¨æˆ·æ— æ³•çœ‹åˆ°é¢„æµ‹çš„æ ‡æ³¨æ¡†ï¼Œä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒã€‚

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### åŸå§‹é—®é¢˜æµç¨‹
```
æ™ºèƒ½é¢„æµ‹è§¦å‘
    â†“
ç›´æ¥è°ƒç”¨ predict_image() æ–¹æ³• âŒ
    â†“
é¢„æµ‹å®Œæˆï¼Œç»“æœå­˜å‚¨åœ¨AIé¢æ¿
    â†“
âŒ ç»“æœæ²¡æœ‰è‡ªåŠ¨åº”ç”¨åˆ°ç”»å¸ƒ
    â†“
ç”¨æˆ·çœ‹ä¸åˆ°é¢„æµ‹ç»“æœ
```

### æ­£ç¡®çš„é¢„æµ‹æµç¨‹
```
æ‰‹åŠ¨é¢„æµ‹æŒ‰é’®
    â†“
å‘é€ prediction_requested ä¿¡å·
    â†“
ä¸»çª—å£æ¥æ”¶å¹¶å¤„ç†
    â†“
é¢„æµ‹å®Œæˆåå‘é€ predictions_applied ä¿¡å·
    â†“
ä¸»çª—å£æ¥æ”¶å¹¶ç»˜åˆ¶åˆ°ç”»å¸ƒ âœ…
```

**æ ¸å¿ƒé—®é¢˜ï¼š** æ™ºèƒ½é¢„æµ‹ç»•è¿‡äº†æ­£å¸¸çš„ä¿¡å·æœºåˆ¶ï¼Œå¯¼è‡´é¢„æµ‹ç»“æœæ— æ³•è‡ªåŠ¨åº”ç”¨åˆ°ç”»å¸ƒã€‚

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤ä¿¡å·è¿æ¥æœºåˆ¶

**ä¿®æ”¹æ–‡ä»¶ï¼š** `labelImg.py`

**åŸå§‹ä»£ç ï¼š**
```python
# ç›´æ¥è°ƒç”¨é¢„æµ‹æ–¹æ³•ï¼ˆé”™è¯¯ï¼‰
success = self.ai_assistant_panel.predict_image(self.file_path)
```

**ä¿®å¤åä»£ç ï¼š**
```python
# è®¾ç½®æ™ºèƒ½é¢„æµ‹çŠ¶æ€æ ‡è®°
self.ai_assistant_panel.is_smart_predicting = True

# ä½¿ç”¨æ­£ç¡®çš„ä¿¡å·æœºåˆ¶è§¦å‘é¢„æµ‹
confidence = self.ai_assistant_panel.get_current_confidence()
self.ai_assistant_panel.prediction_requested.emit(self.file_path, confidence)
```

### 2. æ·»åŠ æ™ºèƒ½é¢„æµ‹çŠ¶æ€ç®¡ç†

**ä¿®æ”¹æ–‡ä»¶ï¼š** `libs/ai_assistant_panel.py`

**æ–°å¢çŠ¶æ€å˜é‡ï¼š**
```python
# ç•Œé¢çŠ¶æ€
self.current_predictions = []
self.is_predicting = False
self.is_smart_predicting = False  # æ™ºèƒ½é¢„æµ‹çŠ¶æ€æ ‡è®°
```

### 3. å®ç°é¢„æµ‹ç»“æœè‡ªåŠ¨åº”ç”¨

**ä¿®æ”¹æ–‡ä»¶ï¼š** `libs/ai_assistant_panel.py`

**å¢å¼ºé¢„æµ‹å®Œæˆå¤„ç†ï¼š**
```python
def on_prediction_completed(self, result):
    """å•å›¾é¢„æµ‹å®Œæˆå¤„ç†"""
    try:
        # ... åŸæœ‰é€»è¾‘ ...
        
        # å¦‚æœæ˜¯æ™ºèƒ½é¢„æµ‹ä¸”æœ‰æ£€æµ‹ç»“æœï¼Œè‡ªåŠ¨åº”ç”¨åˆ°ç”»å¸ƒ
        if self.is_smart_predicting and result.detections:
            print(f"[DEBUG] æ™ºèƒ½é¢„æµ‹å®Œæˆï¼Œè‡ªåŠ¨åº”ç”¨ {len(result.detections)} ä¸ªæ£€æµ‹ç»“æœ")
            self.predictions_applied.emit([result])
            self.update_status(f"ğŸ¤– æ™ºèƒ½é¢„æµ‹å®Œæˆï¼Œå·²è‡ªåŠ¨åº”ç”¨ {len(result.detections)} ä¸ªæ£€æµ‹ç»“æœ")
        elif self.is_smart_predicting:
            self.update_status("ğŸ¤– æ™ºèƒ½é¢„æµ‹å®Œæˆï¼Œæœªæ£€æµ‹åˆ°å¯¹è±¡")
        
        # é‡ç½®æ™ºèƒ½é¢„æµ‹çŠ¶æ€
        self.is_smart_predicting = False
```

### 4. ä¼˜åŒ–ç”¨æˆ·ä½“éªŒåé¦ˆ

**ä¿®æ”¹æ–‡ä»¶ï¼š** `labelImg.py`

**å¢å¼ºçŠ¶æ€æ˜¾ç¤ºï¼š**
```python
def on_ai_predictions_applied(self, predictions):
    """å¤„ç†AIé¢„æµ‹ç»“æœåº”ç”¨"""
    try:
        # ... åº”ç”¨é€»è¾‘ ...
        
        # æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
        if is_smart_prediction:
            self.statusBar().showMessage(
                f'ğŸ‰ æ™ºèƒ½é¢„æµ‹å®Œæˆï¼å·²è‡ªåŠ¨æ·»åŠ  {len(detections)} ä¸ªæ£€æµ‹æ¡†åˆ°ç”»å¸ƒ')
        else:
            self.statusBar().showMessage(
                f'âœ… é¢„æµ‹ç»“æœå·²åº”ç”¨ï¼Œå…±æ·»åŠ  {len(detections)} ä¸ªæ£€æµ‹æ¡†')
```

### 5. é˜²é‡å¤è§¦å‘æœºåˆ¶

**ä¿®æ”¹æ–‡ä»¶ï¼š** `labelImg.py`

**å¢å¼ºçŠ¶æ€æ£€æŸ¥ï¼š**
```python
# æ£€æŸ¥æ˜¯å¦æ­£åœ¨é¢„æµ‹ä¸­ï¼ˆåŒ…æ‹¬æ™ºèƒ½é¢„æµ‹ï¼‰
if hasattr(self.ai_assistant_panel, 'is_predicting') and self.ai_assistant_panel.is_predicting:
    print(f"[DEBUG] æ™ºèƒ½é¢„æµ‹: æ­£åœ¨é¢„æµ‹ä¸­ï¼Œè·³è¿‡")
    return
    
if hasattr(self.ai_assistant_panel, 'is_smart_predicting') and self.ai_assistant_panel.is_smart_predicting:
    print(f"[DEBUG] æ™ºèƒ½é¢„æµ‹: æ™ºèƒ½é¢„æµ‹æ­£åœ¨è¿›è¡Œä¸­ï¼Œè·³è¿‡")
    return
```

## âœ¨ ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰ âŒ
- æ™ºèƒ½é¢„æµ‹æ‰§è¡Œä½†ç»“æœä¸æ˜¾ç¤º
- ç”¨æˆ·ä¸çŸ¥é“é¢„æµ‹æ˜¯å¦æˆåŠŸ
- éœ€è¦æ‰‹åŠ¨ç‚¹å‡»"åº”ç”¨ç»“æœ"æŒ‰é’®
- ç”¨æˆ·ä½“éªŒæå·®

### ä¿®å¤å âœ…
- æ™ºèƒ½é¢„æµ‹ç»“æœè‡ªåŠ¨æ˜¾ç¤ºåœ¨ç”»å¸ƒä¸Š
- çŠ¶æ€æ æ˜¾ç¤ºè¯¦ç»†çš„é¢„æµ‹è¿›åº¦å’Œç»“æœ
- æ— éœ€ä»»ä½•æ‰‹åŠ¨æ“ä½œ
- å®Œç¾çš„ç”¨æˆ·ä½“éªŒ

## ğŸ® ç”¨æˆ·ä½¿ç”¨æµç¨‹

### ç°åœ¨çš„å®Œæ•´ä½“éªŒ
1. **å¼€å¯æ™ºèƒ½é¢„æµ‹**ï¼šå‹¾é€‰"ğŸ¤– æ™ºèƒ½é¢„æµ‹æœªæ ‡æ³¨å›¾ç‰‡"å¤é€‰æ¡†
2. **åŠ è½½å›¾ç‰‡æ–‡ä»¶å¤¹**ï¼šé€‰æ‹©åŒ…å«å¤šå¼ å›¾ç‰‡çš„æ–‡ä»¶å¤¹
3. **åˆ‡æ¢å›¾ç‰‡**ï¼šä½¿ç”¨å¿«æ·é”®æˆ–æŒ‰é’®åˆ‡æ¢åˆ°æœªæ ‡æ³¨çš„å›¾ç‰‡
4. **è‡ªåŠ¨é¢„æµ‹**ï¼šç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹å¹¶å¼€å§‹é¢„æµ‹
5. **çŠ¶æ€æç¤º**ï¼šçŠ¶æ€æ æ˜¾ç¤º"ğŸ¤– æ™ºèƒ½é¢„æµ‹: æ­£åœ¨é¢„æµ‹ xxx.jpg..."
6. **ç»“æœæ˜¾ç¤º**ï¼šé¢„æµ‹å®Œæˆåï¼Œæ£€æµ‹æ¡†è‡ªåŠ¨å‡ºç°åœ¨ç”»å¸ƒä¸Š
7. **æˆåŠŸåé¦ˆ**ï¼šçŠ¶æ€æ æ˜¾ç¤º"ğŸ‰ æ™ºèƒ½é¢„æµ‹å®Œæˆï¼å·²è‡ªåŠ¨æ·»åŠ  X ä¸ªæ£€æµ‹æ¡†åˆ°ç”»å¸ƒ"

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### ä¿¡å·æµç¨‹å›¾
```
å›¾ç‰‡åˆ‡æ¢
    â†“
trigger_smart_prediction_if_needed()
    â†“
è®¾ç½® is_smart_predicting = True
    â†“
å‘é€ prediction_requested ä¿¡å·
    â†“
ä¸»çª—å£ on_ai_prediction_requested()
    â†“
AIé¢æ¿æ‰§è¡Œé¢„æµ‹
    â†“
é¢„æµ‹å®Œæˆ on_prediction_completed()
    â†“
æ£€æµ‹åˆ° is_smart_predicting = True
    â†“
è‡ªåŠ¨å‘é€ predictions_applied ä¿¡å·
    â†“
ä¸»çª—å£ on_ai_predictions_applied()
    â†“
ç»˜åˆ¶æ£€æµ‹æ¡†åˆ°ç”»å¸ƒ
    â†“
æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
```

### å…³é”®æ”¹è¿›ç‚¹
1. **ä¿¡å·æœºåˆ¶**ï¼šä½¿ç”¨æ ‡å‡†çš„ä¿¡å·-æ§½æœºåˆ¶ç¡®ä¿ç»“æœä¼ é€’
2. **çŠ¶æ€ç®¡ç†**ï¼šé€šè¿‡ `is_smart_predicting` æ ‡è®°åŒºåˆ†æ™ºèƒ½é¢„æµ‹å’Œæ‰‹åŠ¨é¢„æµ‹
3. **è‡ªåŠ¨åº”ç”¨**ï¼šæ™ºèƒ½é¢„æµ‹ç»“æœè‡ªåŠ¨åº”ç”¨ï¼Œæ— éœ€ç”¨æˆ·å¹²é¢„
4. **ç”¨æˆ·åé¦ˆ**ï¼šè¯¦ç»†çš„çŠ¶æ€æç¤ºå’Œè¿›åº¦æ˜¾ç¤º
5. **é˜²é‡å¤**ï¼šé¿å…åœ¨é¢„æµ‹è¿‡ç¨‹ä¸­é‡å¤è§¦å‘

## ğŸ‰ æ€»ç»“

é€šè¿‡è¿™æ¬¡ä¿®å¤ï¼Œæ™ºèƒ½é¢„æµ‹åŠŸèƒ½ç°åœ¨çœŸæ­£åšåˆ°äº†"æ™ºèƒ½"ï¼š
- **è‡ªåŠ¨æ£€æµ‹**ï¼šè‡ªåŠ¨è¯†åˆ«æœªæ ‡æ³¨å›¾ç‰‡
- **è‡ªåŠ¨é¢„æµ‹**ï¼šè‡ªåŠ¨æ‰§è¡ŒAIé¢„æµ‹
- **è‡ªåŠ¨æ˜¾ç¤º**ï¼šè‡ªåŠ¨å°†ç»“æœç»˜åˆ¶åˆ°ç”»å¸ƒ
- **è‡ªåŠ¨åé¦ˆ**ï¼šè‡ªåŠ¨æ˜¾ç¤ºæ“ä½œçŠ¶æ€

ç”¨æˆ·ç°åœ¨åªéœ€è¦åˆ‡æ¢å›¾ç‰‡ï¼Œå…¶ä»–ä¸€åˆ‡éƒ½ç”±ç³»ç»Ÿè‡ªåŠ¨å®Œæˆï¼ŒçœŸæ­£å®ç°äº†"ä¸€é”®æ™ºèƒ½æ ‡æ³¨"çš„ç”¨æˆ·ä½“éªŒï¼
